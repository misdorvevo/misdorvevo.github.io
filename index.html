<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will Hatch - Desktop</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Desktop Environment -->
    <div class="desktop">
        <!-- Desktop Icons -->
        <div class="desktop-icons">
            <div class="desktop-icon" data-file="My Computer">
                <svg class="icon-image" viewBox="0 0 24 24" width="32" height="32">
                    <!-- Monitor body -->
                    <rect x="2" y="3" width="20" height="13" fill="#c0c0c0" stroke="#000" stroke-width="1"/>
                    <!-- Beveled edges -->
                    <line x1="2" y1="3" x2="22" y2="3" stroke="#dfdfdf" stroke-width="1"/>
                    <line x1="2" y1="3" x2="2" y2="16" stroke="#dfdfdf" stroke-width="1"/>
                    <line x1="22" y1="3" x2="22" y2="16" stroke="#808080" stroke-width="1"/>
                    <line x1="2" y1="16" x2="22" y2="16" stroke="#808080" stroke-width="1"/>
                    <!-- Screen -->
                    <rect x="3" y="4" width="18" height="11" fill="#000080" stroke="#000" stroke-width="0.5"/>
                    <!-- Screen content -->
                    <rect x="4" y="5" width="16" height="3" fill="#00aaff"/>
                    <rect x="4" y="9" width="2" height="2" fill="#ffff00"/>
                    <rect x="7" y="9" width="2" height="2" fill="#ffff00"/>
                    <rect x="10" y="9" width="2" height="2" fill="#ffff00"/>
                    <!-- Stand -->
                    <rect x="8" y="17" width="8" height="2" fill="#c0c0c0" stroke="#000" stroke-width="0.5"/>
                    <rect x="11" y="19" width="2" height="2" fill="#c0c0c0" stroke="#000" stroke-width="0.5"/>
                </svg>
                <div class="icon-label">My Computer</div>
            </div>
            <div class="desktop-icon" data-file="My Documents">
                <svg class="icon-image" viewBox="0 0 24 24" width="32" height="32">
                    <!-- Folder back -->
                    <path d="M 2 6 L 2 20 Q 2 22 4 22 L 20 22 Q 22 22 22 20 L 22 8 Q 22 6 20 6 L 12 6 L 10 4 Q 9 3 8 4 L 4 6 Q 2 6 2 6 Z" fill="#ffdd00" stroke="#000" stroke-width="1"/>
                    <!-- Folder tab highlight -->
                    <path d="M 2 6 L 8 6 L 10 4 L 12 6" fill="#ffff99" stroke="none"/>
                    <!-- Documents -->
                    <rect x="5" y="9" width="5" height="7" fill="#ffffff" stroke="#000" stroke-width="0.5"/>
                    <line x1="5.5" y1="10" x2="9.5" y2="10" stroke="#000" stroke-width="0.3"/>
                    <line x1="5.5" y1="11" x2="9.5" y2="11" stroke="#000" stroke-width="0.3"/>
                    <line x1="5.5" y1="12" x2="9.5" y2="12" stroke="#000" stroke-width="0.3"/>
                    <line x1="5.5" y1="13" x2="8.5" y2="13" stroke="#000" stroke-width="0.3"/>
                    <!-- Second document -->
                    <rect x="11" y="10" width="5" height="6" fill="#ffffff" stroke="#000" stroke-width="0.5"/>
                    <line x1="11.5" y1="11" x2="15.5" y2="11" stroke="#000" stroke-width="0.3"/>
                    <line x1="11.5" y1="12" x2="15.5" y2="12" stroke="#000" stroke-width="0.3"/>
                    <line x1="11.5" y1="13" x2="14.5" y2="13" stroke="#000" stroke-width="0.3"/>
                </svg>
                <div class="icon-label">My Documents</div>
            </div>
            <div class="desktop-icon" data-file="Readme.txt">
                <svg class="icon-image" viewBox="0 0 24 24" width="32" height="32">
                    <!-- Document with corner fold -->
                    <path d="M 3 2 L 3 20 L 17 20 L 17 7 L 12 2 Z" fill="#ffffff" stroke="#000" stroke-width="1"/>
                    <!-- Corner fold -->
                    <path d="M 12 2 L 17 7 L 12 7 Z" fill="#e6e6e6" stroke="#000" stroke-width="0.5"/>
                    <!-- Title bar -->
                    <rect x="3" y="2" width="14" height="3" fill="#000080"/>
                    <text x="10" y="4" font-size="2" text-anchor="middle" fill="#ffffff" font-weight="bold">TXT</text>
                    <!-- Content lines -->
                    <line x1="4" y1="7" x2="16" y2="7" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="8.5" x2="15" y2="8.5" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="10" x2="16" y2="10" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="11.5" x2="14" y2="11.5" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="13" x2="16" y2="13" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="14.5" x2="15" y2="14.5" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="16" x2="16" y2="16" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="17.5" x2="13" y2="17.5" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="19" x2="15" y2="19" stroke="#000" stroke-width="0.4"/>
                </svg>
                <div class="icon-label">Readme.txt</div>
            </div>
            <div class="desktop-icon" data-file="Projects">
                <svg class="icon-image" viewBox="0 0 24 24" width="32" height="32">
                    <!-- Folder -->
                    <path d="M 2 6 L 2 20 Q 2 22 4 22 L 20 22 Q 22 22 22 20 L 22 8 Q 22 6 20 6 L 12 6 L 10 4 Q 9 3 8 4 L 4 6 Q 2 6 2 6 Z" fill="#ffdd00" stroke="#000" stroke-width="1"/>
                    <!-- Folder tab highlight -->
                    <path d="M 2 6 L 8 6 L 10 4 L 12 6" fill="#ffff99" stroke="none"/>
                    <!-- Divider lines -->
                    <line x1="2" y1="10" x2="22" y2="10" stroke="#000" stroke-width="0.5"/>
                    <line x1="2" y1="15" x2="22" y2="15" stroke="#000" stroke-width="0.5"/>
                </svg>
                <div class="icon-label">Projects</div>
            </div>
            <div class="desktop-icon" data-file="MineSweeper.exe">
                <svg class="icon-image" viewBox="0 0 24 24" width="32" height="32">
                    <!-- Application window -->
                    <rect x="1" y="1" width="22" height="22" fill="#c0c0c0" stroke="#000" stroke-width="1"/>
                    <!-- Beveled frame -->
                    <line x1="1" y1="1" x2="23" y2="1" stroke="#dfdfdf" stroke-width="1"/>
                    <line x1="1" y1="1" x2="1" y2="23" stroke="#dfdfdf" stroke-width="1"/>
                    <line x1="23" y1="1" x2="23" y2="23" stroke="#808080" stroke-width="1"/>
                    <line x1="1" y1="23" x2="23" y2="23" stroke="#808080" stroke-width="1"/>
                    <!-- Title bar -->
                    <rect x="2" y="2" width="20" height="4" fill="#000080" stroke="#000" stroke-width="0.5"/>
                    <text x="12" y="4.5" font-size="2.5" text-anchor="middle" fill="#ffffff" font-weight="bold">MS</text>
                    <!-- Game board -->
                    <rect x="3" y="7" width="18" height="15" fill="#c0c0c0"/>
                    <!-- Mine grid -->
                    <g stroke="#000" stroke-width="0.3">
                        <rect x="4" y="8" width="2.5" height="2.5" fill="#999999"/>
                        <rect x="7" y="8" width="2.5" height="2.5" fill="#cccccc"/>
                        <rect x="10" y="8" width="2.5" height="2.5" fill="#999999"/>
                        <rect x="13" y="8" width="2.5" height="2.5" fill="#ff6666"/>
                        <rect x="16" y="8" width="2.5" height="2.5" fill="#66ff66"/>
                        <rect x="4" y="11.5" width="2.5" height="2.5" fill="#6666ff"/>
                        <rect x="7" y="11.5" width="2.5" height="2.5" fill="#ffff66"/>
                        <rect x="10" y="11.5" width="2.5" height="2.5" fill="#666666"/>
                        <rect x="13" y="11.5" width="2.5" height="2.5" fill="#ff00ff"/>
                        <rect x="16" y="11.5" width="2.5" height="2.5" fill="#00ffff"/>
                    </g>
                </svg>
                <div class="icon-label">MineSweeper.exe</div>
            </div>
        </div>

        <!-- Windows Container -->
        <!-- Start Menu -->
        <div class="start-menu" id="start-menu">
            <div class="start-menu-header">
                <div class="start-menu-logo">Windows 95</div>
            </div>
            <div class="start-menu-items">
                <div class="menu-item" onclick="windowManager.openFolder('Program Files')">
                    <span class="menu-icon">â–¶</span>
                    <span>Programs</span>
                </div>
                <div class="menu-item" onclick="windowManager.openFolder('My Music')">
                    <span class="menu-icon">â–¶</span>
                    <span>Documents</span>
                </div>
                <div class="menu-item" onclick="windowManager.openFolder('Windows')">
                    <span class="menu-icon">â–¶</span>
                    <span>Settings</span>
                </div>
                <div class="menu-separator"></div>
                <div class="menu-item" onclick="alert('Help system not implemented')">
                    <span>Find</span>
                </div>
                <div class="menu-item" onclick="alert('Help system not implemented')">
                    <span>Help</span>
                </div>
                <div class="menu-item" onclick="alert('Run dialog not implemented')">
                    <span>Run...</span>
                </div>
                <div class="menu-separator"></div>
                <div class="menu-item" onclick="if(confirm('Shut down the computer?')) alert('Computer shutdown initiated')">
                    <span>Shut Down...</span>
                </div>
            </div>
        </div>

        <div class="windows-container" id="windows-container"></div>

        <!-- Taskbar -->
        <div class="taskbar">
            <div class="taskbar-start">
                <button class="start-button" id="start-button">Start</button>
            </div>
            <div class="taskbar-windows" id="taskbar-windows"></div>
            <div class="taskbar-tray">
                <span class="system-time" id="system-time">12:00</span>
            </div>
        </div>
    </div>

    <script>
        // ============= FILE SYSTEM SIMULATOR =============
        const fileSystem = {
            files: {
                'About.txt': {
                    type: 'text',
                    content: `Will Hatch - About Me
=====================================

Will Hatch is a junior at Berklee College of Music, specializing in hip-hop and electronic music production. 

Currently active as:
â€¢ vvill - Solo music producer
â€¢ Connxtion - Group producer and collaborator

Known for experimental production techniques and a commitment to the creative process. Always exploring new sounds and pushing boundaries in electronic music.

Based in Boston, MA
Berklee College of Music
Class of 2026`
                },
                'Purpose.txt': {
                    type: 'text',
                    content: `Purpose Statement
=====================================

This project is meant to solve a small but annoying step in the release process for independent artists.

Using a custom tool, artists will be able to create a detailed release plan for their upcoming music releases.

The Problem:
As an independent artist, organization of release timelines, marketing plans, and distribution strategies can be overwhelming. Many tools exist but often overcomplicate the process or don't align with artistic workflow.

The Solution:
A flexible, artist-friendly release planning tool that:
â€¢ Doesn't step on your creative toes
â€¢ Adapts to YOUR goals as an artist
â€¢ Simplifies the release process
â€¢ Takes the stress out of planning

This tool will help artists focus on making great music while staying organized.`
                },
                'Links.url': {
                    type: 'url',
                    content: `Important Links
=====================================

Music Platforms:
â€¢ Apple Music - Listen to vvill & Connxtion tracks
â€¢ Spotify - Follow and discover new releases
â€¢ Bandcamp - Support directly

Social Media:
â€¢ Instagram - @vvill (vvill)
â€¢ Instagram - @connxtion (Connxtion)

Contact:
â€¢ Email: willhatch@berklee.edu
â€¢ Location: Boston, MA

Berklee College of Music
Founded 1945 | Boston, Massachusetts`
                }
            },
            folders: {
                'Projects': {
                    files: {
                        'Release-Planner.txt': {
                            type: 'text',
                            content: `Release Planner Tool
=====================================

Status: In Development

This is the primary project - a comprehensive release planning tool for independent artists.

Features:
â€¢ Timeline visualization
â€¢ Marketing checklist
â€¢ Distribution management
â€¢ Collaborative planning
â€¢ Analytics dashboard

Target Launch: 2026`
                        },
                        'Connxtion-Info.txt': {
                            type: 'text',
                            content: `Connxtion
=====================================

A collaborative music production group focused on creating innovative hip-hop and electronic music.

Members:
â€¢ Will Hatch (Producer)
â€¢ [Other collaborators]

Notable Projects:
â€¢ Multiple collaborative releases
â€¢ Experimental production sessions
â€¢ Community-driven music initiatives

Philosophy:
Pushing creative boundaries while maintaining artistic integrity and collaboration at the core.`
                        }
                    }
                },
                'Program Files': {
                    files: {
                        'Readme.txt': { type: 'text', content: 'Program Files Directory' }
                    },
                    folders: {
                        'Netscape': {
                            files: { 'netscape.exe': { type: 'text', content: 'Netscape Navigator Browser' } }
                        },
                        'Internet Explorer': {
                            files: { 'iexplore.exe': { type: 'text', content: 'Internet Explorer Browser' } }
                        },
                        'Accessories': {
                            files: {
                                'Notepad.exe': { type: 'text', content: 'Simple Text Editor' },
                                'Calculator.exe': { type: 'text', content: 'Calculator Application' },
                                'Paint.exe': { type: 'text', content: 'Paint Application' }
                            }
                        }
                    }
                },
                'Windows': {
                    files: {
                        'System.ini': { type: 'text', content: '[boot]\nshell=explorer.exe\ndevice=vga.drv\n\n[386Enh]\ndevice=*vfd' },
                        'Win.ini': { type: 'text', content: '[Windows]\nload=\nrun=\n\n[Desktop]\nPatternName=Leaves\nWallpaper=' },
                        'Notepad.exe': { type: 'text', content: 'System Notepad' },
                        'Explorer.exe': { type: 'text', content: 'Windows File Explorer' },
                        'Calc.exe': { type: 'text', content: 'Calculator' }
                    },
                    folders: {
                        'System32': {
                            files: {
                                'kernel32.dll': { type: 'text', content: 'Windows Kernel - Core System Library' },
                                'ntdll.dll': { type: 'text', content: 'Native API Library' },
                                'user32.dll': { type: 'text', content: 'User Interface Library' },
                                'gdi32.dll': { type: 'text', content: 'Graphics Device Interface Library' },
                                'shell32.dll': { type: 'text', content: 'Windows Shell Library' },
                                'comctl32.dll': { type: 'text', content: 'Common Controls Library' },
                                'ole32.dll': { type: 'text', content: 'OLE Library' }
                            }
                        },
                        'Drivers': {
                            files: {
                                'vga.drv': { type: 'text', content: 'VGA Display Driver' },
                                'mouse.drv': { type: 'text', content: 'Mouse Driver' },
                                'keyboard.drv': { type: 'text', content: 'Keyboard Driver' },
                                'serial.drv': { type: 'text', content: 'Serial Port Driver' }
                            }
                        },
                        'Fonts': {
                            files: {
                                'arial.ttf': { type: 'text', content: 'Arial Font' },
                                'times.ttf': { type: 'text', content: 'Times New Roman Font' },
                                'courier.ttf': { type: 'text', content: 'Courier New Font' }
                            }
                        }
                    }
                },
                'My Music': {
                    files: {
                        'vvill_tracks.txt': { type: 'text', content: 'vvill Solo Tracks and Releases' }
                    }
                }
            }
        };

        // ============= WINDOW MANAGER =============
        class WindowManager {
            constructor() {
                this.windows = [];
                this.zIndex = 1000;
                this.container = document.getElementById('windows-container');
                this.taskbarWindows = document.getElementById('taskbar-windows');
            }

            openFile(filename, fromFolder = null) {
                // Check if window already open
                const existingWindow = this.windows.find(w => w.filename === filename && w.folder === fromFolder);
                if (existingWindow) {
                    existingWindow.element.style.zIndex = ++this.zIndex;
                    existingWindow.element.classList.remove('minimized');
                    return;
                }

                let fileData;
                if (fromFolder) {
                    fileData = fileSystem.folders[fromFolder].files[filename];
                } else {
                    fileData = fileSystem.files[filename];
                }

                if (!fileData) return;

                const windowElement = this.createWindowElement(filename, fileData, fromFolder);
                this.container.appendChild(windowElement);

                const windowObj = {
                    filename,
                    folder: fromFolder,
                    element: windowElement,
                    content: fileData.content
                };

                this.windows.push(windowObj);
                this.addTaskbarButton(filename, windowObj);
                this.makeWindowDraggable(windowElement);
                windowElement.style.zIndex = ++this.zIndex;
            }

            openFolder(folderName) {
                const existingWindow = this.windows.find(w => w.folder === folderName && w.filename === folderName);
                if (existingWindow) {
                    existingWindow.element.style.zIndex = ++this.zIndex;
                    existingWindow.element.classList.remove('minimized');
                    return;
                }

                const folder = fileSystem.folders[folderName];
                if (!folder) return;

                const windowElement = this.createFolderWindow(folderName, folder);
                this.container.appendChild(windowElement);

                const windowObj = {
                    filename: folderName,
                    folder: folderName,
                    element: windowElement
                };

                this.windows.push(windowObj);
                this.addTaskbarButton(folderName, windowObj);
                this.makeWindowDraggable(windowElement);
                windowElement.style.zIndex = ++this.zIndex;
            }

            createWindowElement(filename, fileData, fromFolder) {
                const isUrl = fileData.type === 'url';
                const windowId = `window-${this.windows.length}`;
                
                const window = document.createElement('div');
                window.className = 'window';
                window.id = windowId;
                window.style.left = (50 + Math.random() * 200) + 'px';
                window.style.top = (50 + Math.random() * 200) + 'px';

                window.innerHTML = `
                    <div class="window-titlebar">
                        <span class="window-title">${filename}</span>
                        <div class="window-buttons">
                            <button class="window-btn minimize-btn" data-window="${windowId}">_</button>
                            <button class="window-btn close-btn" data-window="${windowId}">Ã—</button>
                        </div>
                    </div>
                    <div class="window-content">
                        <div class="file-viewer">
                            <pre>${this.escapeHtml(fileData.content)}</pre>
                        </div>
                    </div>
                `;

                window.querySelector('.minimize-btn').addEventListener('click', () => this.minimizeWindow(windowId));
                window.querySelector('.close-btn').addEventListener('click', () => this.closeWindow(windowId));

                return window;
            }

            createFolderWindow(folderName, folder) {
                const windowId = `window-${this.windows.length}`;
                
                const window = document.createElement('div');
                window.className = 'window';
                window.id = windowId;
                window.style.left = (50 + Math.random() * 200) + 'px';
                window.style.top = (50 + Math.random() * 200) + 'px';
                window.style.width = '400px';

                let filesHtml = '';
                for (const [filename, fileData] of Object.entries(folder.files)) {
                    const icon = fileData.type === 'text' ? 'ðŸ“„' : 'ðŸ”—';
                    filesHtml += `
                        <div class="folder-item" data-file="${filename}" data-folder="${folderName}">
                            <div class="folder-icon">${icon}</div>
                            <div class="folder-name">${filename}</div>
                        </div>
                    `;
                }

                window.innerHTML = `
                    <div class="window-titlebar">
                        <span class="window-title">${folderName}</span>
                        <div class="window-buttons">
                            <button class="window-btn minimize-btn" data-window="${windowId}">_</button>
                            <button class="window-btn close-btn" data-window="${windowId}">Ã—</button>
                        </div>
                    </div>
                    <div class="window-content">
                        <div class="folder-viewer">
                            ${filesHtml}
                        </div>
                    </div>
                `;

                // Add click handlers for files in folder
                window.querySelectorAll('.folder-item').forEach(item => {
                    item.addEventListener('dblclick', () => {
                        const filename = item.dataset.file;
                        const folder = item.dataset.folder;
                        this.openFile(filename, folder);
                    });
                });

                window.querySelector('.minimize-btn').addEventListener('click', () => this.minimizeWindow(windowId));
                window.querySelector('.close-btn').addEventListener('click', () => this.closeWindow(windowId));

                return window;
            }

            makeWindowDraggable(windowElement) {
                const titlebar = windowElement.querySelector('.window-titlebar');
                let offsetX = 0;
                let offsetY = 0;
                let isDragging = false;

                titlebar.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    offsetX = e.clientX - windowElement.offsetLeft;
                    offsetY = e.clientY - windowElement.offsetTop;
                });

                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        windowElement.style.left = (e.clientX - offsetX) + 'px';
                        windowElement.style.top = (e.clientY - offsetY) + 'px';
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });

                windowElement.addEventListener('mousedown', () => {
                    windowElement.style.zIndex = ++this.zIndex;
                });
            }

            minimizeWindow(windowId) {
                const window = document.getElementById(windowId);
                window.classList.toggle('minimized');
            }

            closeWindow(windowId) {
                const window = document.getElementById(windowId);
                const windowObj = this.windows.find(w => w.element.id === windowId);
                
                if (windowObj) {
                    this.windows = this.windows.filter(w => w !== windowObj);
                }

                const taskbarBtn = document.querySelector(`[data-window-id="${windowId}"]`);
                if (taskbarBtn) taskbarBtn.remove();

                window.remove();
            }

            addTaskbarButton(filename, windowObj) {
                const btn = document.createElement('button');
                btn.className = 'taskbar-window-btn';
                btn.dataset.windowId = windowObj.element.id;
                btn.textContent = filename;
                
                btn.addEventListener('click', () => {
                    const isMinimized = windowObj.element.classList.contains('minimized');
                    if (isMinimized) {
                        windowObj.element.classList.remove('minimized');
                        windowObj.element.style.zIndex = ++this.zIndex;
                    } else {
                        windowObj.element.classList.add('minimized');
                    }
                });

                this.taskbarWindows.appendChild(btn);
            }

            escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, m => map[m]);
            }
        }

        // ============= MINESWEEPER GAME =============
        class MineSweeper {
            constructor(difficulty = 'beginner') {
                this.difficulty = difficulty;
                const difficulties = {
                    'beginner': { rows: 8, cols: 10, mines: 10 },
                    'intermediate': { rows: 16, cols: 16, mines: 40 },
                    'expert': { rows: 16, cols: 30, mines: 99 }
                };
                const params = difficulties[difficulty] || difficulties['beginner'];
                this.ROWS = params.rows;
                this.COLS = params.cols;
                this.MINES = params.mines;
                this.board = [];
                this.revealed = [];
                this.flagged = [];
                this.gameOver = false;
                this.startTime = null;
                this.timerInterval = null;
            }

            init() {
                this.board = Array(this.ROWS).fill(null).map(() => Array(this.COLS).fill(0));
                this.revealed = Array(this.ROWS).fill(null).map(() => Array(this.COLS).fill(false));
                this.flagged = Array(this.ROWS).fill(null).map(() => Array(this.COLS).fill(false));
                this.gameOver = false;
                this.startTime = null;
                
                // Place mines
                let minesPlaced = 0;
                while (minesPlaced < this.MINES) {
                    const r = Math.floor(Math.random() * this.ROWS);
                    const c = Math.floor(Math.random() * this.COLS);
                    if (this.board[r][c] !== 'M') {
                        this.board[r][c] = 'M';
                        minesPlaced++;
                    }
                }

                // Calculate numbers
                for (let r = 0; r < this.ROWS; r++) {
                    for (let c = 0; c < this.COLS; c++) {
                        if (this.board[r][c] !== 'M') {
                            let count = 0;
                            for (let dr = -1; dr <= 1; dr++) {
                                for (let dc = -1; dc <= 1; dc++) {
                                    const nr = r + dr, nc = c + dc;
                                    if (nr >= 0 && nr < this.ROWS && nc >= 0 && nc < this.COLS && this.board[nr][nc] === 'M') {
                                        count++;
                                    }
                                }
                            }
                            this.board[r][c] = count;
                        }
                    }
                }
            }

            revealCell(r, c) {
                if (this.gameOver || this.revealed[r][c] || this.flagged[r][c]) return;
                
                if (!this.startTime) {
                    this.startTime = Date.now();
                    this.startTimer();
                }

                if (this.board[r][c] === 'M') {
                    this.gameOver = true;
                    this.revealAllMines();
                    const boardEl = document.getElementById('ms-board');
                    if (boardEl) this.render(boardEl);
                    return;
                }

                this.revealed[r][c] = true;
                if (this.board[r][c] === 0) {
                    this.floodFill(r, c);
                }

                const boardEl = document.getElementById('ms-board');
                if (boardEl) this.render(boardEl);
                this.checkWin();
            }

            flagCell(r, c) {
                if (this.gameOver || this.revealed[r][c]) return;
                this.flagged[r][c] = !this.flagged[r][c];
            }

            floodFill(r, c) {
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const nr = r + dr, nc = c + dc;
                        if (nr >= 0 && nr < this.ROWS && nc >= 0 && nc < this.COLS && !this.revealed[nr][nc]) {
                            this.revealed[nr][nc] = true;
                            if (this.board[nr][nc] === 0) {
                                this.floodFill(nr, nc);
                            }
                        }
                    }
                }
            }

            checkWin() {
                let revealedCount = 0;
                for (let r = 0; r < this.ROWS; r++) {
                    for (let c = 0; c < this.COLS; c++) {
                        if (this.revealed[r][c]) revealedCount++;
                    }
                }
                if (revealedCount === this.ROWS * this.COLS - this.MINES) {
                    this.gameOver = true;
                    clearInterval(this.timerInterval);
                }
            }

            revealAllMines() {
                for (let r = 0; r < this.ROWS; r++) {
                    for (let c = 0; c < this.COLS; c++) {
                        if (this.board[r][c] === 'M') {
                            this.revealed[r][c] = true;
                        }
                    }
                }
                clearInterval(this.timerInterval);
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                    const timerEl = document.getElementById('ms-timer');
                    if (timerEl) timerEl.textContent = elapsed;
                }, 100);
            }

            getMineCount() {
                return this.MINES - this.flagged.flat().filter(f => f).length;
            }

            render(boardEl) {
                boardEl.innerHTML = '';
                for (let r = 0; r < this.ROWS; r++) {
                    for (let c = 0; c < this.COLS; c++) {
                        const cell = document.createElement('div');
                        cell.className = 'ms-cell';

                        if (this.revealed[r][c]) {
                            cell.classList.add('revealed');
                            if (this.board[r][c] === 'M') {
                                cell.textContent = 'ðŸ’£';
                            } else if (this.board[r][c] > 0) {
                                cell.textContent = this.board[r][c];
                                cell.style.color = this.getNumberColor(this.board[r][c]);
                            }
                        } else if (this.flagged[r][c]) {
                            cell.classList.add('flagged');
                            cell.textContent = 'ðŸš©';
                        }

                        cell.addEventListener('click', () => this.revealCell(r, c));
                        cell.addEventListener('contextmenu', (e) => {
                            e.preventDefault();
                            this.flagCell(r, c);
                            this.render(boardEl);
                            this.updateGameInfo();
                        });

                        boardEl.appendChild(cell);
                    }
                }
                this.updateGameInfo();
            }

            updateGameInfo() {
                const counterEl = document.getElementById('ms-counter');
                if (counterEl) counterEl.textContent = this.getMineCount();
            }

            getNumberColor(num) {
                const colors = ['', '#0000ff', '#008000', '#ff0000', '#000080', '#800000', '#008080', '#808080', '#c0c0c0'];
                return colors[num] || '#000000';
            }
        }

        // ============= INITIALIZATION =============
        const windowManager = new WindowManager();
        let minesweeperGame = null;

        // ============= DESKTOP ICON DRAGGING & SELECTION =============
        const desktopIcons = document.querySelectorAll('.desktop-icon');
        const desktopContainer = document.querySelector('.desktop-icons');
        
        let draggedIcon = null;
        let dragStartX = 0;
        let dragStartY = 0;
        let selectionBox = null;
        let isSelecting = false;
        let selectStartX = 0;
        let selectStartY = 0;

        // Create selection box element
        function createSelectionBox() {
            const box = document.createElement('div');
            box.className = 'selection-box';
            document.body.appendChild(box);
            return box;
        }

        selectionBox = createSelectionBox();

        // Icon drag handlers
        desktopIcons.forEach(icon => {
            icon.addEventListener('mousedown', (e) => {
                // Only drag on left mouse button
                if (e.button !== 0) return;
                
                draggedIcon = icon;
                dragStartX = e.clientX - icon.offsetLeft;
                dragStartY = e.clientY - icon.offsetTop;
                
                icon.classList.add('dragging');
                icon.style.position = 'absolute';
                icon.style.zIndex = '1000';
            });

            // Double-click to open
            icon.addEventListener('dblclick', () => {
                const file = icon.dataset.file;
                if (file === 'MineSweeper.exe') {
                    windowManager.openMineSweeper();
                } else if (fileSystem.folders[file]) {
                    windowManager.openFolder(file);
                } else {
                    windowManager.openFile(file);
                }
            });

            // Single click to select
            icon.addEventListener('click', (e) => {
                if (e.detail === 1) { // Single click only
                    // Clear other selections if Ctrl not pressed
                    if (!e.ctrlKey && !e.metaKey) {
                        desktopIcons.forEach(i => i.classList.remove('selected'));
                    }
                    icon.classList.toggle('selected');
                }
            });
        });

        // Desktop area selection box
        desktopContainer.addEventListener('mousedown', (e) => {
            // Only create selection box if clicking on empty space
            if (e.target.closest('.desktop-icon')) return;
            
            isSelecting = true;
            selectStartX = e.clientX;
            selectStartY = e.clientY;
            
            // Clear selections
            desktopIcons.forEach(i => i.classList.remove('selected'));
            
            selectionBox.style.display = 'block';
            selectionBox.style.left = selectStartX + 'px';
            selectionBox.style.top = selectStartY + 'px';
            selectionBox.style.width = '0px';
            selectionBox.style.height = '0px';
        });

        document.addEventListener('mousemove', (e) => {
            // Handle icon dragging
            if (draggedIcon) {
                draggedIcon.style.left = (e.clientX - dragStartX) + 'px';
                draggedIcon.style.top = (e.clientY - dragStartY) + 'px';
            }

            // Handle selection box
            if (isSelecting) {
                const currentX = e.clientX;
                const currentY = e.clientY;
                const width = Math.abs(currentX - selectStartX);
                const height = Math.abs(currentY - selectStartY);
                const left = Math.min(selectStartX, currentX);
                const top = Math.min(selectStartY, currentY);

                selectionBox.style.left = left + 'px';
                selectionBox.style.top = top + 'px';
                selectionBox.style.width = width + 'px';
                selectionBox.style.height = height + 'px';

                // Check which icons are in the selection box
                desktopIcons.forEach(icon => {
                    const iconRect = icon.getBoundingClientRect();
                    const boxRect = {
                        left: left,
                        top: top,
                        right: left + width,
                        bottom: top + height
                    };

                    // Check if icon overlaps with selection box
                    if (iconRect.left < boxRect.right &&
                        iconRect.right > boxRect.left &&
                        iconRect.top < boxRect.bottom &&
                        iconRect.bottom > boxRect.top) {
                        icon.classList.add('selected');
                    } else {
                        icon.classList.remove('selected');
                    }
                });
            }
        });

        document.addEventListener('mouseup', (e) => {
            if (draggedIcon) {
                draggedIcon.classList.remove('dragging');
                draggedIcon = null;
            }

            if (isSelecting) {
                isSelecting = false;
                selectionBox.style.display = 'none';
            }
        });

        // Add openMineSweeper method to WindowManager
        WindowManager.prototype.openMineSweeper = function() {
            const existingWindow = this.windows.find(w => w.filename === 'MineSweeper.exe');
            if (existingWindow) {
                existingWindow.element.style.zIndex = ++this.zIndex;
                existingWindow.element.classList.remove('minimized');
                return;
            }

            const windowId = `window-${this.windows.length}`;
            const window = document.createElement('div');
            window.className = 'window';
            window.id = windowId;
            window.style.left = (50 + Math.random() * 200) + 'px';
            window.style.top = (50 + Math.random() * 200) + 'px';

            window.innerHTML = `
                <div class="window-titlebar">
                    <span class="window-title">MineSweeper.exe</span>
                    <div class="window-buttons">
                        <button class="window-btn minimize-btn" data-window="${windowId}">_</button>
                        <button class="window-btn close-btn" data-window="${windowId}">Ã—</button>
                    </div>
                </div>
                <div class="window-content">
                    <div class="minesweeper-game">
                        <div class="game-info">
                            <div class="difficulty-buttons">
                                <button class="difficulty-btn active" data-difficulty="beginner">Beginner</button>
                                <button class="difficulty-btn" data-difficulty="intermediate">Intermediate</button>
                                <button class="difficulty-btn" data-difficulty="expert">Expert</button>
                            </div>
                            <div class="game-stats">
                                <div class="game-counter">Mines: <span id="ms-counter">10</span></div>
                                <button id="ms-new-game-btn" class="game-button">New Game</button>
                                <div class="game-counter">Time: <span id="ms-timer">0</span>s</div>
                            </div>
                        </div>
                        <div id="ms-board" class="minesweeper-board"></div>
                    </div>
                </div>
            `;

            this.container.appendChild(window);

            const windowObj = {
                filename: 'MineSweeper.exe',
                folder: null,
                element: window,
                currentDifficulty: 'beginner'
            };

            this.windows.push(windowObj);
            this.addTaskbarButton('MineSweeper.exe', windowObj);
            this.makeWindowDraggable(window);
            window.style.zIndex = ++this.zIndex;

            // Initialize game
            minesweeperGame = new MineSweeper('beginner');
            minesweeperGame.init();
            
            const boardEl = document.getElementById('ms-board');
            minesweeperGame.render(boardEl);
            
            // Resize window to fit board
            this.resizeWindowToBoard(window, minesweeperGame);

            // Difficulty button handlers
            window.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const difficulty = btn.dataset.difficulty;
                    windowObj.currentDifficulty = difficulty;
                    
                    // Update active button
                    window.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // New game with difficulty
                    minesweeperGame = new MineSweeper(difficulty);
                    minesweeperGame.init();
                    minesweeperGame.render(boardEl);
                    document.getElementById('ms-timer').textContent = '0';
                    
                    // Resize window
                    this.resizeWindowToBoard(window, minesweeperGame);
                });
            });

            document.getElementById('ms-new-game-btn').addEventListener('click', () => {
                minesweeperGame = new MineSweeper(windowObj.currentDifficulty);
                minesweeperGame.init();
                minesweeperGame.render(boardEl);
                document.getElementById('ms-timer').textContent = '0';
            });

            window.querySelector('.minimize-btn').addEventListener('click', () => this.minimizeWindow(windowId));
            window.querySelector('.close-btn').addEventListener('click', () => this.closeWindow(windowId));
        };

        WindowManager.prototype.resizeWindowToBoard = function(windowEl, game) {
            // Calculate content size based on board
            const cellSize = 30;
            const gap = 1;
            const boardWidth = (game.COLS * cellSize) + ((game.COLS - 1) * gap) + 8; // padding
            const boardHeight = (game.ROWS * cellSize) + ((game.ROWS - 1) * gap) + 8; // padding
            
            // Add space for controls
            const contentHeight = boardHeight + 120; // game-info + padding
            const contentWidth = Math.max(boardWidth, 350); // minimum width
            
            // Set window dimensions
            windowEl.style.width = contentWidth + 'px';
            windowEl.style.height = contentHeight + 'px';
        };

        // Start button - toggle start menu
        document.getElementById('start-button').addEventListener('click', () => {
            const startMenu = document.getElementById('start-menu');
            startMenu.classList.toggle('active');
        });

        // Close start menu when clicking elsewhere
        document.addEventListener('click', (e) => {
            const startMenu = document.getElementById('start-menu');
            const startButton = document.getElementById('start-button');
            if (!startMenu.contains(e.target) && !startButton.contains(e.target)) {
                startMenu.classList.remove('active');
            }
        });

        // Update system time
        function updateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('system-time').textContent = time;
        }
        updateTime();
        setInterval(updateTime, 1000);
    </script>
</body>
</html>
