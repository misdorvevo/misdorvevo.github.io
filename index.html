<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will Hatch - Desktop</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Desktop Environment -->
    <div class="desktop">
        <!-- Desktop Icons -->
        <div class="desktop-icons">
            <div class="desktop-icon" data-file="My Computer">
                <svg class="icon-image" viewBox="0 0 24 24" width="32" height="32">
                    <rect x="2" y="3" width="20" height="13" fill="#c0c0c0" stroke="#000" stroke-width="1"/>
                    <line x1="2" y1="3" x2="22" y2="3" stroke="#dfdfdf" stroke-width="1"/>
                    <line x1="2" y1="3" x2="2" y2="16" stroke="#dfdfdf" stroke-width="1"/>
                    <line x1="22" y1="3" x2="22" y2="16" stroke="#808080" stroke-width="1"/>
                    <line x1="2" y1="16" x2="22" y2="16" stroke="#808080" stroke-width="1"/>
                    <rect x="3" y="4" width="18" height="11" fill="#000080" stroke="#000" stroke-width="0.5"/>
                    <rect x="4" y="5" width="16" height="3" fill="#00aaff"/>
                    <rect x="4" y="9" width="2" height="2" fill="#ffff00"/>
                    <rect x="7" y="9" width="2" height="2" fill="#ffff00"/>
                    <rect x="10" y="9" width="2" height="2" fill="#ffff00"/>
                    <rect x="8" y="17" width="8" height="2" fill="#c0c0c0" stroke="#000" stroke-width="0.5"/>
                    <rect x="11" y="19" width="2" height="2" fill="#c0c0c0" stroke="#000" stroke-width="0.5"/>
                </svg>
                <div class="icon-label">My Computer</div>
            </div>
            <div class="desktop-icon" data-file="My Documents">
                <svg class="icon-image" viewBox="0 0 24 24" width="32" height="32">
                    <path d="M 2 6 L 2 20 Q 2 22 4 22 L 20 22 Q 22 22 22 20 L 22 8 Q 22 6 20 6 L 12 6 L 10 4 Q 9 3 8 4 L 4 6 Q 2 6 2 6 Z" fill="#ffdd00" stroke="#000" stroke-width="1"/>
                    <path d="M 2 6 L 8 6 L 10 4 L 12 6" fill="#ffff99" stroke="none"/>
                    <rect x="5" y="9" width="5" height="7" fill="#ffffff" stroke="#000" stroke-width="0.5"/>
                    <line x1="5.5" y1="10" x2="9.5" y2="10" stroke="#000" stroke-width="0.3"/>
                    <line x1="5.5" y1="11" x2="9.5" y2="11" stroke="#000" stroke-width="0.3"/>
                    <line x1="5.5" y1="12" x2="9.5" y2="12" stroke="#000" stroke-width="0.3"/>
                    <line x1="5.5" y1="13" x2="8.5" y2="13" stroke="#000" stroke-width="0.3"/>
                    <rect x="11" y="10" width="5" height="6" fill="#ffffff" stroke="#000" stroke-width="0.5"/>
                    <line x1="11.5" y1="11" x2="15.5" y2="11" stroke="#000" stroke-width="0.3"/>
                    <line x1="11.5" y1="12" x2="15.5" y2="12" stroke="#000" stroke-width="0.3"/>
                    <line x1="11.5" y1="13" x2="14.5" y2="13" stroke="#000" stroke-width="0.3"/>
                </svg>
                <div class="icon-label">My Documents</div>
            </div>
            <div class="desktop-icon" data-file="Readme.txt">
                <svg class="icon-image" viewBox="0 0 24 24" width="32" height="32">
                    <path d="M 3 2 L 3 20 L 17 20 L 17 7 L 12 2 Z" fill="#ffffff" stroke="#000" stroke-width="1"/>
                    <path d="M 12 2 L 17 7 L 12 7 Z" fill="#e6e6e6" stroke="#000" stroke-width="0.5"/>
                    <rect x="3" y="2" width="14" height="3" fill="#000080"/>
                    <text x="10" y="4" font-size="2" text-anchor="middle" fill="#ffffff" font-weight="bold">TXT</text>
                    <line x1="4" y1="7" x2="16" y2="7" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="8.5" x2="15" y2="8.5" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="10" x2="16" y2="10" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="11.5" x2="14" y2="11.5" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="13" x2="16" y2="13" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="14.5" x2="15" y2="14.5" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="16" x2="16" y2="16" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="17.5" x2="13" y2="17.5" stroke="#000" stroke-width="0.4"/>
                    <line x1="4" y1="19" x2="15" y2="19" stroke="#000" stroke-width="0.4"/>
                </svg>
                <div class="icon-label">Readme.txt</div>
            </div>
            <div class="desktop-icon" data-file="Games">
                <svg class="icon-image" viewBox="0 0 24 24" width="32" height="32">
                    <path d="M 2 6 L 2 20 Q 2 22 4 22 L 20 22 Q 22 22 22 20 L 22 8 Q 22 6 20 6 L 12 6 L 10 4 Q 9 3 8 4 L 4 6 Q 2 6 2 6 Z" fill="#ff6b9d" stroke="#000" stroke-width="1"/>
                    <path d="M 2 6 L 8 6 L 10 4 L 12 6" fill="#ff99bb" stroke="none"/>
                    <circle cx="8" cy="12" r="2" fill="#ffff00"/>
                    <rect x="13" y="11" width="3" height="2" fill="#00ff00"/>
                    <rect x="13" y="14" width="3" height="2" fill="#0000ff"/>
                </svg>
                <div class="icon-label">Games</div>
            </div>
            <div class="desktop-icon" data-file="MineSweeper.exe">
                <svg class="icon-image" viewBox="0 0 24 24" width="32" height="32">
                    <rect x="1" y="1" width="22" height="22" fill="#c0c0c0" stroke="#000" stroke-width="1"/>
                    <line x1="1" y1="1" x2="23" y2="1" stroke="#dfdfdf" stroke-width="1"/>
                    <line x1="1" y1="1" x2="1" y2="23" stroke="#dfdfdf" stroke-width="1"/>
                    <line x1="23" y1="1" x2="23" y2="23" stroke="#808080" stroke-width="1"/>
                    <line x1="1" y1="23" x2="23" y2="23" stroke="#808080" stroke-width="1"/>
                    <rect x="2" y="2" width="20" height="4" fill="#000080" stroke="#000" stroke-width="0.5"/>
                    <text x="12" y="4.5" font-size="2.5" text-anchor="middle" fill="#ffffff" font-weight="bold">MS</text>
                    <rect x="3" y="7" width="18" height="15" fill="#c0c0c0"/>
                    <g stroke="#000" stroke-width="0.3">
                        <rect x="4" y="8" width="2.5" height="2.5" fill="#999999"/>
                        <rect x="7" y="8" width="2.5" height="2.5" fill="#cccccc"/>
                        <rect x="10" y="8" width="2.5" height="2.5" fill="#999999"/>
                        <rect x="13" y="8" width="2.5" height="2.5" fill="#ff6666"/>
                        <rect x="16" y="8" width="2.5" height="2.5" fill="#66ff66"/>
                        <rect x="4" y="11.5" width="2.5" height="2.5" fill="#6666ff"/>
                        <rect x="7" y="11.5" width="2.5" height="2.5" fill="#ffff66"/>
                        <rect x="10" y="11.5" width="2.5" height="2.5" fill="#666666"/>
                        <rect x="13" y="11.5" width="2.5" height="2.5" fill="#ff00ff"/>
                        <rect x="16" y="11.5" width="2.5" height="2.5" fill="#00ffff"/>
                    </g>
                </svg>
                <div class="icon-label">MineSweeper.exe</div>
            </div>
        </div>

        <!-- Start Menu -->
        <div class="start-menu" id="start-menu">
            <div class="start-menu-header">
                <div class="start-menu-logo">Windows 95</div>
            </div>
            <div class="start-menu-items">
                <div class="menu-item" onclick="windowManager.openFolder('Program Files')">
                    <span class="menu-icon">▶</span>
                    <span>Programs</span>
                </div>
                <div class="menu-item" onclick="windowManager.openFolder('My Music')">
                    <span class="menu-icon">▶</span>
                    <span>Documents</span>
                </div>
                <div class="menu-item" onclick="windowManager.openFolder('Windows')">
                    <span class="menu-icon">▶</span>
                    <span>Settings</span>
                </div>
                <div class="menu-separator"></div>
                <div class="menu-item" onclick="alert('Help system not implemented')">
                    <span>Find</span>
                </div>
                <div class="menu-item" onclick="alert('Help system not implemented')">
                    <span>Help</span>
                </div>
                <div class="menu-item" onclick="alert('Run dialog not implemented')">
                    <span>Run...</span>
                </div>
                <div class="menu-separator"></div>
                <div class="menu-item" onclick="if(confirm('Shut down the computer?')) alert('Computer shutdown initiated')">
                    <span>Shut Down...</span>
                </div>
            </div>
        </div>

        <div class="windows-container" id="windows-container"></div>

        <!-- Taskbar -->
        <div class="taskbar">
            <div class="taskbar-start">
                <button class="start-button" id="start-button">Start</button>
            </div>
            <div class="taskbar-windows" id="taskbar-windows"></div>
            <div class="taskbar-tray">
                <span class="system-time" id="system-time">12:00</span>
            </div>
        </div>
    </div>

    <script>
        // ============= ENHANCED FILE SYSTEM WITH 20+ APPLICATIONS =============
        const fileSystem = {
            files: {
                'About.txt': {
                    type: 'text',
                    icon: 'document',
                    content: `Will Hatch - About Me\n=====================================\n\nWill Hatch is a junior at Berklee College of Music, specializing in hip-hop and electronic music production.\n\nCurrently active as:\n• vvill - Solo music producer\n• Connxtion - Group producer and collaborator\n\nBased in Boston, MA`
                },
                'Purpose.txt': {
                    type: 'text',
                    icon: 'document',
                    content: `Release Planner Tool\n=====================================\nStatus: In Development\n\nThis tool helps independent artists organize release timelines, marketing plans, and distribution strategies.`
                },
                'Links.url': {
                    type: 'url',
                    icon: 'link',
                    content: `Important Links\n=====================================\n\nMusic: Apple Music, Spotify, Bandcamp\nSocial: Instagram (@vvill, @connxtion)\nEmail: willhatch@berklee.edu`
                }
            },
            folders: {
                'Games': {
                    icon: 'gamesfolder',
                    files: {
                        'PokemonRadicalRed.exe': { type: 'app', icon: 'pokemon', appType: 'pokemon', content: 'Pokemon Radical Red Emulator' },
                        'Snake.exe': { type: 'app', icon: 'snake', appType: 'snake', content: 'Classic Snake Game' },
                        'Pac-Man.exe': { type: 'app', icon: 'pacman', appType: 'pacman', content: 'Pac-Man Game' },
                        'Breakout.exe': { type: 'app', icon: 'breakout', appType: 'breakout', content: 'Breakout Game' },
                        'Solitaire.exe': { type: 'app', icon: 'solitaire', appType: 'solitaire', content: 'Solitaire Card Game' }
                    }
                },
                'Program Files': {
                    icon: 'programfolder',
                    files: {
                        'Internet Explorer.exe': { type: 'app', icon: 'ie', appType: 'ie', content: 'Internet Explorer' },
                        'Netscape.exe': { type: 'app', icon: 'netscape', appType: 'netscape', content: 'Netscape Navigator' },
                        'Winamp.exe': { type: 'app', icon: 'winamp', appType: 'winamp', content: 'Winamp Music Player' },
                        'mIRC.exe': { type: 'app', icon: 'mirc', appType: 'mirc', content: 'mIRC Chat Client' },
                        'AIM.exe': { type: 'app', icon: 'aim', appType: 'aim', content: 'AOL Instant Messenger' }
                    },
                    folders: {
                        'Accessories': {
                            icon: 'folder',
                            files: {
                                'Notepad.exe': { type: 'app', icon: 'notepad', appType: 'notepad', content: 'Simple Text Editor' },
                                'Paint.exe': { type: 'app', icon: 'paint', appType: 'paint', content: 'Paint Application' },
                                'Calculator.exe': { type: 'app', icon: 'calculator', appType: 'calculator', content: 'Basic Calculator' },
                                'WordPad.exe': { type: 'app', icon: 'wordpad', appType: 'wordpad', content: 'Word Processor' }
                            }
                        }
                    }
                },
                'System Utilities': {
                    icon: 'utilfolder',
                    files: {
                        'Device Manager.exe': { type: 'app', icon: 'devicemgr', appType: 'devicemgr', content: 'Device Manager' },
                        'Task Manager.exe': { type: 'app', icon: 'taskmgr', appType: 'taskmgr', content: 'Task Manager' },
                        'Registry Editor.exe': { type: 'app', icon: 'regedit', appType: 'regedit', content: 'Registry Editor' },
                        'System Monitor.exe': { type: 'app', icon: 'sysmon', appType: 'sysmon', content: 'System Monitor' }
                    }
                },
                'Viruses': {
                    icon: 'viralfolder',
                    files: {
                        'MEMZ.exe': { type: 'app', icon: 'virus', appType: 'memz', content: 'Malware Simulator' },
                        'Badware.exe': { type: 'app', icon: 'virus', appType: 'virus', content: 'Virus Simulator' },
                        'CoolPatch.exe': { type: 'app', icon: 'virus', appType: 'patch', content: 'Fake Security Patch' }
                    }
                },
                'Windows': {
                    icon: 'windowsfolder',
                    files: {
                        'System.ini': { type: 'text', icon: 'textfile', content: '[boot]\nshell=explorer.exe\ndevice=vga.drv' },
                        'Win.ini': { type: 'text', icon: 'textfile', content: '[Windows]\nload=\nrun=\n[Desktop]\nWallpaper=' },
                        'Config.sys': { type: 'text', icon: 'textfile', content: 'device=himem.sys\ndevice=emm386.exe\nshell=command.com' }
                    },
                    folders: {
                        'System32': {
                            icon: 'folder',
                            files: {
                                'kernel32.dll': { type: 'text', icon: 'dll', content: 'Windows Kernel Library' },
                                'user32.dll': { type: 'text', icon: 'dll', content: 'User Interface Library' },
                                'gdi32.dll': { type: 'text', icon: 'dll', content: 'Graphics Device Interface' },
                                'shell32.dll': { type: 'text', icon: 'dll', content: 'Shell Library' },
                                'ntdll.dll': { type: 'text', icon: 'dll', content: 'Native API Library' }
                            }
                        },
                        'Drivers': {
                            icon: 'folder',
                            files: {
                                'vga.drv': { type: 'text', icon: 'driver', content: 'VGA Display Driver' },
                                'mouse.drv': { type: 'text', icon: 'driver', content: 'Mouse Driver' },
                                'kbd.drv': { type: 'text', icon: 'driver', content: 'Keyboard Driver' },
                                'serial.drv': { type: 'text', icon: 'driver', content: 'Serial Port Driver' }
                            }
                        }
                    }
                },
                'My Documents': {
                    icon: 'docfolder',
                    files: {
                        'Resume.doc': { type: 'text', icon: 'document', content: 'Will Hatch Resume - Audio Engineering & Production' },
                        'Music Notes.txt': { type: 'text', icon: 'document', content: 'Production Notes\n- Work on beat patterns\n- Improve mixing skills\n- Collaborate with Connxtion' }
                    }
                },
                'My Music': {
                    icon: 'musicfolder',
                    files: {
                        'vvill - Track 01.mp3': { type: 'audio', icon: 'audio', content: 'Audio File' },
                        'vvill - Track 02.mp3': { type: 'audio', icon: 'audio', content: 'Audio File' },
                        'Connxtion - Collab.mp3': { type: 'audio', icon: 'audio', content: 'Audio File' }
                    }
                }
            }
        };

        // ============= WINDOW MANAGER (Enhanced) =============
        class WindowManager {
            constructor() {
                this.windows = [];
                this.zIndex = 1000;
                this.container = document.getElementById('windows-container');
                this.taskbarWindows = document.getElementById('taskbar-windows');
                this.appStates = {}; // Store app states
            }

            getIconSVG(iconType) {
                const icons = {
                    document: `<svg viewBox="0 0 16 16" width="16" height="16"><path d="M 2 0 L 2 14 L 12 14 L 12 4 L 8 0 Z" fill="#ffffff" stroke="#000" stroke-width="0.5"/><path d="M 8 0 L 12 4 L 8 4 Z" fill="#e0e0e0"/></svg>`,
                    folder: `<svg viewBox="0 0 16 16" width="16" height="16"><path d="M 1 3 L 1 14 L 15 14 L 15 4 L 8 4 L 6 2 L 1 2 Z" fill="#ffcc00" stroke="#000" stroke-width="0.5"/></svg>`,
                    executable: `<svg viewBox="0 0 16 16" width="16" height="16"><rect x="1" y="1" width="14" height="12" fill="#c0c0c0" stroke="#000" stroke-width="0.5"/><rect x="2" y="2" width="12" height="2" fill="#000080"/></svg>`,
                    dll: `<svg viewBox="0 0 16 16" width="16" height="16"><rect x="2" y="1" width="12" height="13" fill="#ffccff" stroke="#000" stroke-width="0.5"/><text x="8" y="10" font-size="6" text-anchor="middle" fill="#000">DLL</text></svg>`,
                    driver: `<svg viewBox="0 0 16 16" width="16" height="16"><rect x="2" y="2" width="12" height="11" fill="#ccccff" stroke="#000" stroke-width="0.5"/></svg>`,
                    pokemon: `<svg viewBox="0 0 16 16" width="16" height="16"><circle cx="8" cy="8" r="6" fill="#ffcc00" stroke="#000" stroke-width="0.5"/><rect x="4" y="5" width="8" height="6" fill="#ff0000" opacity="0.5"/></svg>`,
                    virus: `<svg viewBox="0 0 16 16" width="16" height="16"><circle cx="8" cy="8" r="5" fill="#ff0000" stroke="#000" stroke-width="0.5"/><circle cx="8" cy="8" r="3" fill="none" stroke="#ff0000" stroke-width="0.5"/></svg>`,
                    link: `<svg viewBox="0 0 16 16" width="16" height="16"><path d="M 3 8 Q 3 3 8 3 Q 13 3 13 8" fill="none" stroke="#0000ff" stroke-width="1"/><path d="M 3 8 Q 3 13 8 13 Q 13 13 13 8" fill="none" stroke="#0000ff" stroke-width="1"/></svg>`
                };
                return icons[iconType] || icons.document;
            }

            openFile(filename, fromFolder = null) {
                const existingWindow = this.windows.find(w => w.filename === filename && w.folder === fromFolder);
                if (existingWindow) {
                    existingWindow.element.style.zIndex = ++this.zIndex;
                    existingWindow.element.classList.remove('minimized');
                    return;
                }

                let fileData;
                if (fromFolder) {
                    fileData = fileSystem.folders[fromFolder].files[filename];
                } else {
                    fileData = fileSystem.files[filename];
                }

                if (!fileData) return;

                // Handle app files
                if (fileData.type === 'app') {
                    this.openApplication(fileData.appType, filename);
                    return;
                }

                const windowElement = this.createWindowElement(filename, fileData, fromFolder);
                this.container.appendChild(windowElement);

                const windowObj = {
                    filename,
                    folder: fromFolder,
                    element: windowElement,
                    content: fileData.content
                };

                this.windows.push(windowObj);
                this.addTaskbarButton(filename, windowObj);
                this.makeWindowDraggable(windowElement);
                windowElement.style.zIndex = ++this.zIndex;
            }

            openApplication(appType, appName) {
                // Check if already open
                const existingWindow = this.windows.find(w => w.appType === appType);
                if (existingWindow) {
                    existingWindow.element.style.zIndex = ++this.zIndex;
                    existingWindow.element.classList.remove('minimized');
                    return;
                }

                const windowId = `window-${this.windows.length}`;
                const window = document.createElement('div');
                window.className = 'window';
                window.id = windowId;
                window.style.left = (50 + Math.random() * 200) + 'px';
                window.style.top = (50 + Math.random() * 200) + 'px';

                let content = '';

                // Generate content based on app type
                switch(appType) {
                    case 'pokemon':
                        window.style.width = '480px';
                        window.style.height = '432px';
                        content = `<div style="width: 480px; height: 400px; background: #000; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: bold;">Pokemon Radical Red Emulator<br/><small>(Simulated)</small></div>`;
                        break;
                    case 'snake':
                        window.style.width = '320px';
                        window.style.height = '340px';
                        content = `<div id="snake-game" style="width: 320px; height: 320px; background: #000; border: 2px solid #000080;"></div>`;
                        break;
                    case 'calculator':
                        window.style.width = '280px';
                        content = `<div class="calculator-app"><input type="text" id="calc-display" style="width: 100%; margin-bottom: 5px;" value="0" readonly></div>`;
                        break;
                    case 'notepad':
                        window.style.width = '600px';
                        window.style.height = '400px';
                        content = `<textarea style="width: 100%; height: 100%; border: 1px inset; padding: 5px; font-family: Courier; resize: none;"></textarea>`;
                        break;
                    case 'ie':
                        window.style.width = '640px';
                        window.style.height = '480px';
                        content = `<div style="background: #c0c0c0; height: 100%; display: flex; flex-direction: column;"><div style="background: #ffffff; padding: 10px; flex: 1; overflow: hidden;"><p style="color: #0000ff; text-decoration: underline;">Welcome to Internet Explorer</p><p>This simulated browser cannot access the internet.</p></div></div>`;
                        break;
                    case 'winamp':
                        window.style.width = '275px';
                        content = `<div class="winamp-app" style="background: linear-gradient(135deg, #33cc33, #00ff00); padding: 10px; text-align: center;"><div style="margin: 10px 0; color: #000; font-weight: bold;">Now Playing: No File</div><div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px;"><button>Prev</button><button>Play</button><button>Pause</button><button>Next</button></div></div>`;
                        break;
                    case 'taskmgr':
                        content = `<div style="padding: 10px; font-size: 11px;"><table style="width: 100%; border-collapse: collapse;"><tr style="background: #000080; color: #fff;"><td>Process</td><td>CPU</td><td>Memory</td></tr><tr><td>explorer.exe</td><td>2%</td><td>45MB</td></tr><tr style="background: #c0c0c0;"><td>notepad.exe</td><td>1%</td><td>8MB</td></tr></table></div>`;
                        break;
                    case 'memz':
                    case 'virus':
                    case 'patch':
                        window.style.width = '400px';
                        window.style.height = '300px';
                        content = this.generateVirusWindow(appType);
                        break;
                    case 'paint':
                        window.style.width = '640px';
                        window.style.height = '480px';
                        content = `<div style="background: #ffffff; width: 100%; height: 100%; border: 1px solid #808080;"></div>`;
                        break;
                    case 'wordpad':
                        window.style.width = '600px';
                        window.style.height = '400px';
                        content = `<div style="padding: 5px;"><textarea style="width: 100%; height: 100%; border: 1px inset; font-family: Times New Roman; resize: none;"></textarea></div>`;
                        break;
                    case 'solitaire':
                        window.style.width = '480px';
                        window.style.height = '400px';
                        content = `<div style="background: #00aa00; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: bold;">Solitaire Game<br/><button onclick="alert('Game Started!')">Deal Cards</button></div>`;
                        break;
                    case 'devicemgr':
                        content = `<div style="padding: 10px;"><p><strong>Devices:</strong></p><ul style="margin: 0;"><li>Video: VGA Display</li><li>Audio: SoundBlaster Pro</li><li>Network: Ethernet</li><li>Storage: IDE Hard Disk</li></ul></div>`;
                        break;
                    case 'regedit':
                        content = `<div style="padding: 10px; font-family: Courier; font-size: 10px;"><pre>HKEY_LOCAL_MACHINE
  ├─ SOFTWARE
  │  ├─ Microsoft
  │  │  └─ Windows
  │  └─ Netscape
  ├─ SYSTEM
  └─ SECURITY</pre></div>`;
                        break;
                    case 'sysmon':
                        content = `<div style="padding: 10px;"><p><strong>System Monitor</strong></p><canvas id="sysmon-chart" width="300" height="150" style="border: 1px solid #000;"></canvas></div>`;
                        break;
                    default:
                        content = `<div style="padding: 10px;"><p>Application: ${appName}</p><p>Content loading...</p></div>`;
                }

                window.innerHTML = `
                    <div class="window-titlebar">
                        <span class="window-title">${appName}</span>
                        <div class="window-buttons">
                            <button class="window-btn minimize-btn" data-window="${windowId}">_</button>
                            <button class="window-btn close-btn" data-window="${windowId}">×</button>
                        </div>
                    </div>
                    <div class="window-content">
                        ${content}
                    </div>
                `;

                this.container.appendChild(window);

                const windowObj = {
                    filename: appName,
                    appType: appType,
                    element: window
                };

                this.windows.push(windowObj);
                this.addTaskbarButton(appName, windowObj);
                this.makeWindowDraggable(window);
                window.style.zIndex = ++this.zIndex;

                window.querySelector('.minimize-btn').addEventListener('click', () => this.minimizeWindow(windowId));
                window.querySelector('.close-btn').addEventListener('click', () => this.closeWindow(windowId));
            }

            generateVirusWindow(type) {
                if (type === 'memz') {
                    return `<div style="background: #000; color: #0f0; padding: 10px; font-family: Courier; height: 250px; overflow-y: auto; animation: flicker 0.15s;"><p>MEMZ.exe - Memory Corruption Detected</p><p style="animation: glitch 0.2s infinite;">System files corrupted...</p><p>⚠ WARNING: System Integrity Check Failed</p><p style="color: #f00;">CRITICAL ERROR</p></div>`;
                } else if (type === 'virus') {
                    return `<div style="padding: 10px;"><p style="color: #ff0000; font-weight: bold;">⚠ VIRUS DETECTED</p><p>File: BADWARE.EXE</p><p>Status: <span style="color: #ff0000;">INFECTED</span></p><p>Action: Quarantine / Delete / Ignore</p><button onclick="alert('Action not available')">Scan Now</button></div>`;
                } else {
                    return `<div style="padding: 10px;"><p><strong>Windows Security Update</strong></p><p>Downloading: CoolPatch v1.0</p><div style="width: 300px; height: 20px; border: 1px solid #000; margin: 10px 0;"><div style="width: 45%; height: 100%; background: #0080ff;"></div></div><p>45% Complete</p><button onclick="alert('Update starting...')">Install Update</button></div>`;
                }
            }

            openFolder(folderName) {
                const existingWindow = this.windows.find(w => w.folder === folderName && w.filename === folderName);
                if (existingWindow) {
                    existingWindow.element.style.zIndex = ++this.zIndex;
                    existingWindow.element.classList.remove('minimized');
                    return;
                }

                const folder = fileSystem.folders[folderName];
                if (!folder) return;

                const windowElement = this.createFolderWindow(folderName, folder);
                this.container.appendChild(windowElement);

                const windowObj = {
                    filename: folderName,
                    folder: folderName,
                    element: windowElement
                };

                this.windows.push(windowObj);
                this.addTaskbarButton(folderName, windowObj);
                this.makeWindowDraggable(windowElement);
                windowElement.style.zIndex = ++this.zIndex;
            }

            createWindowElement(filename, fileData, fromFolder) {
                const windowId = `window-${this.windows.length}`;
                
                const window = document.createElement('div');
                window.className = 'window';
                window.id = windowId;
                window.style.left = (50 + Math.random() * 200) + 'px';
                window.style.top = (50 + Math.random() * 200) + 'px';

                window.innerHTML = `
                    <div class="window-titlebar">
                        <span class="window-title">${filename}</span>
                        <div class="window-buttons">
                            <button class="window-btn minimize-btn" data-window="${windowId}">_</button>
                            <button class="window-btn close-btn" data-window="${windowId}">×</button>
                        </div>
                    </div>
                    <div class="window-content">
                        <div class="file-viewer">
                            <pre>${this.escapeHtml(fileData.content)}</pre>
                        </div>
                    </div>
                `;

                window.querySelector('.minimize-btn').addEventListener('click', () => this.minimizeWindow(windowId));
                window.querySelector('.close-btn').addEventListener('click', () => this.closeWindow(windowId));

                return window;
            }

            createFolderWindow(folderName, folder) {
                const windowId = `window-${this.windows.length}`;
                
                const window = document.createElement('div');
                window.className = 'window';
                window.id = windowId;
                window.style.left = (50 + Math.random() * 200) + 'px';
                window.style.top = (50 + Math.random() * 200) + 'px';
                window.style.width = '500px';
                window.style.minHeight = '300px';

                let itemsHtml = '';
                
                // Add subfolders
                if (folder.folders) {
                    for (const [subfolderName, subfolder] of Object.entries(folder.folders)) {
                        itemsHtml += `
                            <div class="folder-item" data-folder="${subfolderName}" data-type="folder">
                                <svg class="folder-icon" viewBox="0 0 24 24" width="32" height="32">
                                    <path d="M 2 6 L 2 20 Q 2 22 4 22 L 20 22 Q 22 22 22 20 L 22 8 Q 22 6 20 6 L 12 6 L 10 4 Q 9 3 8 4 L 4 6 Q 2 6 2 6 Z" fill="#ffdd00" stroke="#000" stroke-width="1"/>
                                    <path d="M 2 6 L 8 6 L 10 4 L 12 6" fill="#ffff99" stroke="none"/>
                                </svg>
                                <div class="folder-name">${subfolderName}</div>
                            </div>
                        `;
                    }
                }

                // Add files
                for (const [filename, fileData] of Object.entries(folder.files)) {
                    itemsHtml += `
                        <div class="folder-item" data-file="${filename}" data-folder="${folderName}" data-type="file">
                            <svg class="folder-icon" viewBox="0 0 24 24" width="32" height="32">
                                <path d="M 3 2 L 3 20 L 17 20 L 17 7 L 12 2 Z" fill="#ffffff" stroke="#000" stroke-width="1"/>
                                <path d="M 12 2 L 17 7 L 12 7 Z" fill="#e6e6e6" stroke="#000" stroke-width="0.5"/>
                            </svg>
                            <div class="folder-name">${filename}</div>
                        </div>
                    `;
                }

                window.innerHTML = `
                    <div class="window-titlebar">
                        <span class="window-title">${folderName}</span>
                        <div class="window-buttons">
                            <button class="window-btn minimize-btn" data-window="${windowId}">_</button>
                            <button class="window-btn close-btn" data-window="${windowId}">×</button>
                        </div>
                    </div>
                    <div class="window-content">
                        <div class="folder-viewer">
                            ${itemsHtml}
                        </div>
                    </div>
                `;

                // Add click handlers
                window.querySelectorAll('.folder-item').forEach(item => {
                    const isFolder = item.dataset.type === 'folder';
                    const name = isFolder ? item.dataset.folder : item.dataset.file;
                    const fromFolder = item.dataset.folder;

                    item.addEventListener('dblclick', () => {
                        if (isFolder) {
                            const subfolder = fileSystem.folders[folderName].folders[name];
                            this.openFolderPath(folderName + '/' + name, subfolder);
                        } else {
                            this.openFile(name, folderName);
                        }
                    });
                });

                window.querySelector('.minimize-btn').addEventListener('click', () => this.minimizeWindow(windowId));
                window.querySelector('.close-btn').addEventListener('click', () => this.closeWindow(windowId));

                return window;
            }

            openFolderPath(path, folder) {
                const windowId = `window-${this.windows.length}`;
                
                const window = document.createElement('div');
                window.className = 'window';
                window.id = windowId;
                window.style.left = (50 + Math.random() * 200) + 'px';
                window.style.top = (50 + Math.random() * 200) + 'px';
                window.style.width = '500px';
                window.style.minHeight = '300px';

                let itemsHtml = '';
                
                if (folder.folders) {
                    for (const [subfolderName, subfolder] of Object.entries(folder.folders)) {
                        itemsHtml += `
                            <div class="folder-item" data-folder="${subfolderName}" data-type="folder">
                                <svg class="folder-icon" viewBox="0 0 24 24" width="32" height="32">
                                    <path d="M 2 6 L 2 20 Q 2 22 4 22 L 20 22 Q 22 22 22 20 L 22 8 Q 22 6 20 6 L 12 6 L 10 4 Q 9 3 8 4 L 4 6 Q 2 6 2 6 Z" fill="#ffdd00" stroke="#000" stroke-width="1"/>
                                    <path d="M 2 6 L 8 6 L 10 4 L 12 6" fill="#ffff99" stroke="none"/>
                                </svg>
                                <div class="folder-name">${subfolderName}</div>
                            </div>
                        `;
                    }
                }

                for (const [filename, fileData] of Object.entries(folder.files)) {
                    itemsHtml += `
                        <div class="folder-item" data-file="${filename}" data-type="file">
                            <svg class="folder-icon" viewBox="0 0 24 24" width="32" height="32">
                                <path d="M 3 2 L 3 20 L 17 20 L 17 7 L 12 2 Z" fill="#ffffff" stroke="#000" stroke-width="1"/>
                                <path d="M 12 2 L 17 7 L 12 7 Z" fill="#e6e6e6" stroke="#000" stroke-width="0.5"/>
                            </svg>
                            <div class="folder-name">${filename}</div>
                        </div>
                    `;
                }

                window.innerHTML = `
                    <div class="window-titlebar">
                        <span class="window-title">${path}</span>
                        <div class="window-buttons">
                            <button class="window-btn minimize-btn" data-window="${windowId}">_</button>
                            <button class="window-btn close-btn" data-window="${windowId}">×</button>
                        </div>
                    </div>
                    <div class="window-content">
                        <div class="folder-viewer">
                            ${itemsHtml}
                        </div>
                    </div>
                `;

                this.container.appendChild(window);

                window.querySelectorAll('.folder-item').forEach(item => {
                    const isFolder = item.dataset.type === 'folder';
                    const name = isFolder ? item.dataset.folder : item.dataset.file;

                    item.addEventListener('dblclick', () => {
                        if (isFolder) {
                            const subfolder = folder.folders[name];
                            this.openFolderPath(path + '/' + name, subfolder);
                        } else {
                            const fileData = folder.files[name];
                            if (fileData.type === 'app') {
                                this.openApplication(fileData.appType, name);
                            } else {
                                const viewWindow = this.createWindowElement(name, fileData, path);
                                this.container.appendChild(viewWindow);
                                this.windows.push({ filename: name, folder: path, element: viewWindow });
                                this.addTaskbarButton(name, { filename: name, folder: path, element: viewWindow });
                                this.makeWindowDraggable(viewWindow);
                                viewWindow.style.zIndex = ++this.zIndex;
                            }
                        }
                    });
                });

                const windowObj = { filename: path, folder: path, element: window };
                this.windows.push(windowObj);
                this.addTaskbarButton(path.split('/').pop(), windowObj);
                this.makeWindowDraggable(window);
                window.style.zIndex = ++this.zIndex;

                window.querySelector('.minimize-btn').addEventListener('click', () => this.minimizeWindow(windowId));
                window.querySelector('.close-btn').addEventListener('click', () => this.closeWindow(windowId));
            }

            makeWindowDraggable(windowElement) {
                const titlebar = windowElement.querySelector('.window-titlebar');
                let offsetX = 0;
                let offsetY = 0;
                let isDragging = false;

                titlebar.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    offsetX = e.clientX - windowElement.offsetLeft;
                    offsetY = e.clientY - windowElement.offsetTop;
                });

                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        windowElement.style.left = (e.clientX - offsetX) + 'px';
                        windowElement.style.top = (e.clientY - offsetY) + 'px';
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });

                windowElement.addEventListener('mousedown', () => {
                    windowElement.style.zIndex = ++this.zIndex;
                });
            }

            minimizeWindow(windowId) {
                const window = document.getElementById(windowId);
                window.classList.toggle('minimized');
            }

            closeWindow(windowId) {
                const window = document.getElementById(windowId);
                const windowObj = this.windows.find(w => w.element.id === windowId);
                
                if (windowObj) {
                    this.windows = this.windows.filter(w => w !== windowObj);
                }

                const taskbarBtn = document.querySelector(`[data-window-id="${windowId}"]`);
                if (taskbarBtn) taskbarBtn.remove();

                window.remove();
            }

            addTaskbarButton(filename, windowObj) {
                const btn = document.createElement('button');
                btn.className = 'taskbar-window-btn';
                btn.dataset.windowId = windowObj.element.id;
                btn.textContent = filename;
                
                btn.addEventListener('click', () => {
                    const isMinimized = windowObj.element.classList.contains('minimized');
                    if (isMinimized) {
                        windowObj.element.classList.remove('minimized');
                        windowObj.element.style.zIndex = ++this.zIndex;
                    } else {
                        windowObj.element.classList.add('minimized');
                    }
                });

                this.taskbarWindows.appendChild(btn);
            }

            escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, m => map[m]);
            }
        }

        // ============= INITIALIZATION =============
        const windowManager = new WindowManager();

        // Desktop icon handlers
        const desktopIcons = document.querySelectorAll('.desktop-icon');
        const desktopContainer = document.querySelector('.desktop-icons');
        
        let draggedIcon = null;
        let dragStartX = 0;
        let dragStartY = 0;

        desktopIcons.forEach(icon => {
            icon.addEventListener('mousedown', (e) => {
                if (e.button !== 0) return;
                draggedIcon = icon;
                dragStartX = e.clientX - icon.offsetLeft;
                dragStartY = e.clientY - icon.offsetTop;
                icon.classList.add('dragging');
                icon.style.position = 'absolute';
            });

            icon.addEventListener('dblclick', () => {
                const file = icon.dataset.file;
                if (file === 'MineSweeper.exe') {
                    windowManager.openApplication('minesweeper', 'MineSweeper.exe');
                } else if (fileSystem.folders[file]) {
                    windowManager.openFolder(file);
                } else {
                    windowManager.openFile(file);
                }
            });

            icon.addEventListener('click', (e) => {
                if (e.detail === 1) {
                    if (!e.ctrlKey && !e.metaKey) {
                        desktopIcons.forEach(i => i.classList.remove('selected'));
                    }
                    icon.classList.toggle('selected');
                }
            });
        });

        document.addEventListener('mousemove', (e) => {
            if (draggedIcon) {
                draggedIcon.style.left = (e.clientX - dragStartX) + 'px';
                draggedIcon.style.top = (e.clientY - dragStartY) + 'px';
            }
        });

        document.addEventListener('mouseup', () => {
            if (draggedIcon) {
                draggedIcon.classList.remove('dragging');
                draggedIcon = null;
            }
        });

        // Start button
        document.getElementById('start-button').addEventListener('click', () => {
            const startMenu = document.getElementById('start-menu');
            startMenu.classList.toggle('active');
        });

        document.addEventListener('click', (e) => {
            const startMenu = document.getElementById('start-menu');
            const startButton = document.getElementById('start-button');
            if (!startMenu.contains(e.target) && !startButton.contains(e.target)) {
                startMenu.classList.remove('active');
            }
        });

        // System time
        function updateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('system-time').textContent = time;
        }
        updateTime();
        setInterval(updateTime, 1000);
    </script>
</body>
</html>
